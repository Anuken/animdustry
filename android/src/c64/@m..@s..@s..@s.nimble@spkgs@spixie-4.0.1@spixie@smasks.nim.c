/* Generated by Nim Compiler v1.6.4 */
#define NIM_INTBITS 64
#define NIM_EmulateOverflowChecks

#include "nimbase.h"
#include <string.h>
#include <math.h>
#undef LANGUAGE_C
#undef MIPSEB
#undef MIPSEL
#undef PPC
#undef R3000
#undef R4000
#undef i386
#undef linux
#undef mips
#undef near
#undef far
#undef powerpc
#undef unix
#define nimfr_(x, y)
#define nimln_(x, y)
typedef struct tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q;
typedef struct tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A;
typedef struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ tySequence__6H5Oh5UUvVCLiakt9aTwtUQ;
typedef struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content;
typedef struct tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ;
typedef struct tyObject_ValueError__yoNlBGx0D2tRizIdhQuENw tyObject_ValueError__yoNlBGx0D2tRizIdhQuENw;
typedef struct tyObject_CatchableError__qrLSDoe2oBoAqNtJ9badtnA tyObject_CatchableError__qrLSDoe2oBoAqNtJ9badtnA;
typedef struct Exception Exception;
typedef struct RootObj RootObj;
typedef struct TNimTypeV2 TNimTypeV2;
typedef struct NimStrPayload NimStrPayload;
typedef struct NimStringV2 NimStringV2;
typedef struct tySequence__uB9b75OUPRENsBAu4AnoePA tySequence__uB9b75OUPRENsBAu4AnoePA;
typedef struct tySequence__uB9b75OUPRENsBAu4AnoePA_Content tySequence__uB9b75OUPRENsBAu4AnoePA_Content;
typedef struct tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ;
typedef struct tyObject_StackTraceEntry__oLyohQ7O2XOvGnflOss8EA tyObject_StackTraceEntry__oLyohQ7O2XOvGnflOss8EA;
struct tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A {
NI rc;
};
struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ {
  NI len; tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content* p;
};
struct tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q {
NI width;
NI height;
tySequence__6H5Oh5UUvVCLiakt9aTwtUQ data;
};
struct TNimTypeV2 {
void* destructor;
NI size;
NI align;
NCSTRING name;
void* traceImpl;
void* typeInfoV1;
NI flags;
};
struct RootObj {
TNimTypeV2* m_type;
};
struct NimStrPayload {
NI cap;
NIM_CHAR data[SEQ_DECL_SIZE];
};
struct NimStringV2 {
NI len;
NimStrPayload* p;
};
struct tySequence__uB9b75OUPRENsBAu4AnoePA {
  NI len; tySequence__uB9b75OUPRENsBAu4AnoePA_Content* p;
};
struct Exception {
  RootObj Sup;
Exception* parent;
NCSTRING name;
NimStringV2 message;
tySequence__uB9b75OUPRENsBAu4AnoePA trace;
Exception* up;
};
struct tyObject_CatchableError__qrLSDoe2oBoAqNtJ9badtnA {
  Exception Sup;
};
struct tyObject_ValueError__yoNlBGx0D2tRizIdhQuENw {
  tyObject_CatchableError__qrLSDoe2oBoAqNtJ9badtnA Sup;
};
struct tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ {
  tyObject_ValueError__yoNlBGx0D2tRizIdhQuENw Sup;
};
struct tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ {
tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask;
};


#ifndef tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content_PP
#define tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content_PP
struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content { NI cap; NU8 data[SEQ_DECL_SIZE];};
#endif

      

#ifndef tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content_PP
#define tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content_PP
struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content { NI cap; NU8 data[SEQ_DECL_SIZE];};
#endif

      struct tyObject_StackTraceEntry__oLyohQ7O2XOvGnflOss8EA {
NCSTRING procname;
NI line;
NCSTRING filename;
};


#ifndef tySequence__uB9b75OUPRENsBAu4AnoePA_Content_PP
#define tySequence__uB9b75OUPRENsBAu4AnoePA_Content_PP
struct tySequence__uB9b75OUPRENsBAu4AnoePA_Content { NI cap; tyObject_StackTraceEntry__oLyohQ7O2XOvGnflOss8EA data[SEQ_DECL_SIZE];};
#endif

      static N_INLINE(NIM_BOOL, nimDecRefIsLast)(void* p);
static N_INLINE(NI, minuspercent___system_716)(NI x, NI y);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_23)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* dest);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___pureZtimes_1997)(tySequence__6H5Oh5UUvVCLiakt9aTwtUQ* dest);
N_LIB_PRIVATE N_NIMCALL(void, nimRawDispose)(void* p, NI alignment);
N_LIB_PRIVATE N_NIMCALL(void*, nimNewObj)(NI size, NI alignment);
N_LIB_PRIVATE N_NIMCALL(void, raiseExceptionEx)(Exception* e, NCSTRING ename, NCSTRING procname, NCSTRING filename, NI line);
N_LIB_PRIVATE N_NIMCALL(void, eqsink___pureZtimes_2003)(tySequence__6H5Oh5UUvVCLiakt9aTwtUQ* dest, tySequence__6H5Oh5UUvVCLiakt9aTwtUQ src);
N_LIB_PRIVATE N_NIMCALL(tySequence__6H5Oh5UUvVCLiakt9aTwtUQ, newSeq__stdZsysrand_69)(NI len);
static N_INLINE(void, nimIncRef)(void* p);
N_LIB_PRIVATE N_NIMCALL(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q*, copy__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_45)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask);
N_LIB_PRIVATE N_NIMCALL(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q*, newMask__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_11)(NI width, NI height);
N_LIB_PRIVATE N_NIMCALL(void, eqcopy___pureZtimes_2000)(tySequence__6H5Oh5UUvVCLiakt9aTwtUQ* dest, tySequence__6H5Oh5UUvVCLiakt9aTwtUQ src);
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_33)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q** dest);
N_LIB_PRIVATE N_NIMCALL(void, eqcopy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_36)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q** dest, tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* src);
N_LIB_PRIVATE N_NIMCALL(void, eqsink___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_39)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q** dest, tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* src);
static N_INLINE(void, nimZeroMem)(void* p, NI size);
static N_INLINE(void, nimSetMem__systemZmemory_7)(void* a, int v, NI size);
static N_INLINE(NI, dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask, NI x, NI y);
N_LIB_PRIVATE N_NIMCALL(NI, roof___pureZtimes_2617)(NI x, NI y);
static N_INLINE(void, copyMem__system_1709)(void* dest, void* source, NI size);
static N_INLINE(void, nimCopyMem)(void* dest, void* source, NI size);
static N_INLINE(NF32, fractional__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_177)(NF32 v);
static N_INLINE(NF32, abs__OOZfauZsrcZfauZfmath_71)(NF32 x);
static N_INLINE(NU8, X5BX5D___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_72)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask, NI x, NI y);
static N_INLINE(NIM_BOOL, inside__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_51)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask, NI x, NI y);
static N_INLINE(NU8, mix__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZcommon_29)(NU8 a, NU8 b, NF32 t);
extern TNimTypeV2 NTIv2__iGcRqvltYLQCoM1tI9cqukQ_;
static const struct {
  NI cap; NIM_CHAR data[33+1];
} TM__Gq3vYfp7VbF11klu5pinjg_2 = { 33 | NIM_STRLIT_FLAG, "Mask width and height must be > 0" };
static const NimStringV2 TM__Gq3vYfp7VbF11klu5pinjg_3 = {33, (NimStrPayload*)&TM__Gq3vYfp7VbF11klu5pinjg_2};
static const struct {
  NI cap; NIM_CHAR data[36+1];
} TM__Gq3vYfp7VbF11klu5pinjg_4 = { 36 | NIM_STRLIT_FLAG, "Cannot minifyBy2 with negative power" };
static const NimStringV2 TM__Gq3vYfp7VbF11klu5pinjg_5 = {36, (NimStrPayload*)&TM__Gq3vYfp7VbF11klu5pinjg_4};
static const struct {
  NI cap; NIM_CHAR data[37+1];
} TM__Gq3vYfp7VbF11klu5pinjg_6 = { 37 | NIM_STRLIT_FLAG, "Cannot magnifyBy2 with negative power" };
static const NimStringV2 TM__Gq3vYfp7VbF11klu5pinjg_7 = {37, (NimStrPayload*)&TM__Gq3vYfp7VbF11klu5pinjg_6};
extern NIM_BOOL nimInErrorMode__system_3443;
static N_INLINE(NI, minuspercent___system_716)(NI x, NI y) {
	NI result;
	result = (NI)0;
	result = ((NI) ((NU)((NU64)(((NU) (x))) - (NU64)(((NU) (y))))));
	return result;
}
static N_INLINE(NIM_BOOL, nimDecRefIsLast)(void* p) {
	NIM_BOOL result;
	result = (NIM_BOOL)0;
	{
		tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A* cell;
		NI T5_;
		if (!!((p == NIM_NIL))) goto LA3_;
		T5_ = (NI)0;
		T5_ = minuspercent___system_716(((NI) (ptrdiff_t) (p)), ((NI) 8));
		cell = ((tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A*) (T5_));
		{
			if (!((NI)((*cell).rc & ((NI) -8)) == ((NI) 0))) goto LA8_;
			result = NIM_TRUE;
		}
		goto LA6_;
		LA8_: ;
		{
			(*cell).rc -= ((NI) 8);
		}
		LA6_: ;
	}
	LA3_: ;
	return result;
}
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_23)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* dest) {
	eqdestroy___pureZtimes_1997((&(*dest).data));
}
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_33)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q** dest) {
	{
		NIM_BOOL T3_;
		T3_ = (NIM_BOOL)0;
		T3_ = nimDecRefIsLast((*dest));
		if (!T3_) goto LA4_;
		eqdestroy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_23((*dest));
		nimRawDispose((*dest), ((NI) 8));
	}
	LA4_: ;
}
N_LIB_PRIVATE N_NIMCALL(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q*, newMask__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_11)(NI width, NI height) {
	tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* result;
	tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* T8_;
	tySequence__6H5Oh5UUvVCLiakt9aTwtUQ T9_;
{	result = NIM_NIL;
	{
		NIM_BOOL T3_;
		tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ* T7_;
		T3_ = (NIM_BOOL)0;
		T3_ = (width <= ((NI) 0));
		if (T3_) goto LA4_;
		T3_ = (height <= ((NI) 0));
		LA4_: ;
		if (!T3_) goto LA5_;
		T7_ = NIM_NIL;
		T7_ = (tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ*) nimNewObj(sizeof(tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ), NIM_ALIGNOF(tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ));
		(*T7_).Sup.Sup.Sup.Sup.m_type = (&NTIv2__iGcRqvltYLQCoM1tI9cqukQ_);
		(*T7_).Sup.Sup.Sup.name = "PixieError";
		(*T7_).Sup.Sup.Sup.message = TM__Gq3vYfp7VbF11klu5pinjg_3;
		(*T7_).Sup.Sup.Sup.parent = ((Exception*) NIM_NIL);
		raiseExceptionEx((Exception*)T7_, "PixieError", "newMask", "masks.nim", 21);
		goto BeforeRet_;
	}
	LA5_: ;
	T8_ = NIM_NIL;
	T8_ = (tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q*) nimNewObj(sizeof(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q), NIM_ALIGNOF(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q));
	result = T8_;
	(*result).width = width;
	(*result).height = height;
	T9_.len = 0; T9_.p = NIM_NIL;
	T9_ = newSeq__stdZsysrand_69(((NI) ((NI)(width * height))));
	eqsink___pureZtimes_2003((&(*result).data), T9_);
	}BeforeRet_: ;
	return result;
}
static N_INLINE(void, nimIncRef)(void* p) {
	NI T1_;
	T1_ = (NI)0;
	T1_ = minuspercent___system_716(((NI) (ptrdiff_t) (p)), ((NI) 8));
	(*((tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A*) (T1_))).rc += ((NI) 8);
}
N_LIB_PRIVATE N_NIMCALL(void, eqcopy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_36)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q** dest, tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* src) {
	{
		if (!src) goto LA3_;
		nimIncRef(src);
	}
	LA3_: ;
	{
		NIM_BOOL T7_;
		T7_ = (NIM_BOOL)0;
		T7_ = nimDecRefIsLast((*dest));
		if (!T7_) goto LA8_;
		eqdestroy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_23((*dest));
		nimRawDispose((*dest), ((NI) 8));
	}
	LA8_: ;
	(*dest) = src;
}
N_LIB_PRIVATE N_NIMCALL(void, eqsink___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_39)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q** dest, tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* src) {
	{
		NIM_BOOL T3_;
		T3_ = (NIM_BOOL)0;
		T3_ = nimDecRefIsLast((*dest));
		if (!T3_) goto LA4_;
		eqdestroy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_23((*dest));
		nimRawDispose((*dest), ((NI) 8));
	}
	LA4_: ;
	(*dest) = src;
}
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void) {
	NIM_BOOL* result;
	result = (NIM_BOOL*)0;
	result = (&nimInErrorMode__system_3443);
	return result;
}
N_LIB_PRIVATE N_NIMCALL(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q*, copy__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_45)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask) {
	tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* result;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = NIM_NIL;
	result = newMask__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_11((*mask).width, (*mask).height);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	eqcopy___pureZtimes_2000((&(*result).data), (*mask).data);
	}BeforeRet_: ;
	return result;
}
static N_INLINE(void, nimSetMem__systemZmemory_7)(void* a, int v, NI size) {
	void* T1_;
	T1_ = (void*)0;
	T1_ = memset(a, v, ((size_t) (size)));
}
static N_INLINE(void, nimZeroMem)(void* p, NI size) {
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	nimSetMem__systemZmemory_7(p, ((int) 0), size);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
}
static N_INLINE(NI, dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask, NI x, NI y) {
	NI result;
	result = (NI)0;
	result = (NI)((NI)((*mask).width * y) + x);
	return result;
}
N_LIB_PRIVATE N_NIMCALL(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q*, minifyBy2__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_104)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask, NI power) {
	tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* result;
	tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* src;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = NIM_NIL;
	src = NIM_NIL;
	{
		tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ* T6_;
		if (!(power < ((NI) 0))) goto LA4_;
		T6_ = NIM_NIL;
		T6_ = (tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ*) nimNewObj(sizeof(tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ), NIM_ALIGNOF(tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ));
		(*T6_).Sup.Sup.Sup.Sup.m_type = (&NTIv2__iGcRqvltYLQCoM1tI9cqukQ_);
		(*T6_).Sup.Sup.Sup.name = "PixieError";
		(*T6_).Sup.Sup.Sup.message = TM__Gq3vYfp7VbF11klu5pinjg_5;
		(*T6_).Sup.Sup.Sup.parent = ((Exception*) NIM_NIL);
		raiseExceptionEx((Exception*)T6_, "PixieError", "minifyBy2", "masks.nim", 82);
		goto LA1_;
	}
	LA4_: ;
	{
		if (!(power == ((NI) 0))) goto LA9_;
		result = copy__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_45(mask);
		if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
		eqdestroy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_33(&src);
		goto BeforeRet_;
	}
	LA9_: ;
	eqcopy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_36(&src, mask);
	{
		NI i;
		NI res;
		i = (NI)0;
		res = ((NI) 1);
		{
			while (1) {
				tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* T14_;
				if (!(res <= power)) goto LA13;
				i = res;
				T14_ = NIM_NIL;
				T14_ = newMask__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_11((NI)((*src).width / ((NI) 2)), (NI)((*src).height / ((NI) 2)));
				if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
				eqsink___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_39(&result, T14_);
				{
					NI y;
					NI i_2;
					y = (NI)0;
					i_2 = ((NI) 0);
					{
						while (1) {
							NI x;
							if (!(i_2 < (*result).height)) goto LA17;
							y = i_2;
							x = (NI)0;
							{
								NI x_2;
								NI i_3;
								x_2 = (NI)0;
								i_3 = x;
								{
									while (1) {
										NU32 value;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T21_;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T22_;
										NI T23_;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T24_;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T25_;
										NI T26_;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T27_;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T28_;
										NI T29_;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T30_;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T31_;
										NI T32_;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T33_;
										tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T34_;
										NI T35_;
										if (!(i_3 < (*result).width)) goto LA20;
										x_2 = i_3;
										nimZeroMem((void*)(&T21_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T21_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T21_.mask = src;
										nimZeroMem((void*)(&T22_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T22_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T22_.mask = src;
										T23_ = (NI)0;
										T23_ = dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56(T22_.mask, (NI)((NI)(x_2 * ((NI) 2)) + ((NI) 0)), (NI)((NI)(y * ((NI) 2)) + ((NI) 0)));
										if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
										nimZeroMem((void*)(&T24_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T24_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T24_.mask = src;
										nimZeroMem((void*)(&T25_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T25_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T25_.mask = src;
										T26_ = (NI)0;
										T26_ = dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56(T25_.mask, (NI)((NI)(x_2 * ((NI) 2)) + ((NI) 1)), (NI)((NI)(y * ((NI) 2)) + ((NI) 0)));
										if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
										nimZeroMem((void*)(&T27_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T27_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T27_.mask = src;
										nimZeroMem((void*)(&T28_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T28_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T28_.mask = src;
										T29_ = (NI)0;
										T29_ = dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56(T28_.mask, (NI)((NI)(x_2 * ((NI) 2)) + ((NI) 1)), (NI)((NI)(y * ((NI) 2)) + ((NI) 1)));
										if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
										nimZeroMem((void*)(&T30_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T30_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T30_.mask = src;
										nimZeroMem((void*)(&T31_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T31_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T31_.mask = src;
										T32_ = (NI)0;
										T32_ = dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56(T31_.mask, (NI)((NI)(x_2 * ((NI) 2)) + ((NI) 0)), (NI)((NI)(y * ((NI) 2)) + ((NI) 1)));
										if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
										value = (NU32)((NU32)((NU32)((NU32)((NU32)((NU32)(((NU32) ((*T21_.mask).data.p->data[T23_]))) + (NU32)(((NU32) ((*T24_.mask).data.p->data[T26_]))))) + (NU32)(((NU32) ((*T27_.mask).data.p->data[T29_]))))) + (NU32)(((NU32) ((*T30_.mask).data.p->data[T32_]))));
										nimZeroMem((void*)(&T33_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T33_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T33_.mask = result;
										nimZeroMem((void*)(&T34_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										nimZeroMem((void*)(&T34_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
										T34_.mask = result;
										T35_ = (NI)0;
										T35_ = dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56(T34_.mask, x_2, y);
										if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
										(*T33_.mask).data.p->data[T35_] = ((NU8) ((NU32)((NU32)(value) / (NU32)(((NU32) 4)))));
										i_3 += ((NI) 1);
									} LA20: ;
								}
							}
							i_2 += ((NI) 1);
						} LA17: ;
					}
				}
				eqcopy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_36(&src, result);
				res += ((NI) 1);
			} LA13: ;
		}
	}
	{
		LA1_:;
	}
	{
		eqdestroy___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_33(&src);
	}
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}
static N_INLINE(void, nimCopyMem)(void* dest, void* source, NI size) {
	void* T1_;
	T1_ = (void*)0;
	T1_ = memcpy(dest, source, ((size_t) (size)));
}
static N_INLINE(void, copyMem__system_1709)(void* dest, void* source, NI size) {
	nimCopyMem(dest, source, size);
}
N_LIB_PRIVATE N_NIMCALL(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q*, magnifyBy2__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_127)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask, NI power) {
	tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* result;
	NI scale;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = NIM_NIL;
	{
		tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ* T5_;
		if (!(power < ((NI) 0))) goto LA3_;
		T5_ = NIM_NIL;
		T5_ = (tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ*) nimNewObj(sizeof(tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ), NIM_ALIGNOF(tyObject_PixieError__iGcRqvltYLQCoM1tI9cqukQ));
		(*T5_).Sup.Sup.Sup.Sup.m_type = (&NTIv2__iGcRqvltYLQCoM1tI9cqukQ_);
		(*T5_).Sup.Sup.Sup.name = "PixieError";
		(*T5_).Sup.Sup.Sup.message = TM__Gq3vYfp7VbF11klu5pinjg_7;
		(*T5_).Sup.Sup.Sup.parent = ((Exception*) NIM_NIL);
		raiseExceptionEx((Exception*)T5_, "PixieError", "magnifyBy2", "masks.nim", 165);
		goto BeforeRet_;
	}
	LA3_: ;
	scale = roof___pureZtimes_2617(((NI) 2), ((NI) (power)));
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	result = newMask__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_11((NI)((*mask).width * scale), (NI)((*mask).height * scale));
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	{
		NI y;
		NI i;
		y = (NI)0;
		i = ((NI) 0);
		{
			while (1) {
				NI x;
				NI rowStart;
				if (!(i < (*mask).height)) goto LA8;
				y = i;
				x = (NI)0;
				{
					NI x_2;
					NI i_2;
					x_2 = (NI)0;
					i_2 = x;
					{
						while (1) {
							NU8 value;
							tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T12_;
							tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T13_;
							NI T14_;
							NI scaledX;
							NI idx;
							if (!(i_2 < (*mask).width)) goto LA11;
							x_2 = i_2;
							nimZeroMem((void*)(&T12_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
							nimZeroMem((void*)(&T12_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
							T12_.mask = mask;
							nimZeroMem((void*)(&T13_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
							nimZeroMem((void*)(&T13_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
							T13_.mask = mask;
							T14_ = (NI)0;
							T14_ = dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56(T13_.mask, x_2, (NI)(y / scale));
							if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
							value = (*T12_.mask).data.p->data[T14_];
							scaledX = (NI)(x_2 * scale);
							idx = dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56(result, scaledX, y);
							if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
							{
								NI i_3;
								NI i_4;
								i_3 = (NI)0;
								i_4 = ((NI) 0);
								{
									while (1) {
										if (!(i_4 < scale)) goto LA17;
										i_3 = i_4;
										(*result).data.p->data[(NI)(idx + i_3)] = value;
										i_4 += ((NI) 1);
									} LA17: ;
								}
							}
							i_2 += ((NI) 1);
						} LA11: ;
					}
				}
				rowStart = dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56(result, ((NI) 0), (NI)(y * scale));
				if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
				{
					NI i_5;
					NI i_6;
					i_5 = (NI)0;
					i_6 = ((NI) 1);
					{
						while (1) {
							void* T21_;
							if (!(i_6 < scale)) goto LA20;
							i_5 = i_6;
							T21_ = (void*)0;
							T21_ = ((void*) ((&(*result).data.p->data[(NI)(rowStart + (NI)((*result).width * i_5))])));
							copyMem__system_1709(T21_, ((void*) ((&(*result).data.p->data[rowStart]))), ((NI) ((NI)((*result).width * ((NI) 4)))));
							i_6 += ((NI) 1);
						} LA20: ;
					}
				}
				i += ((NI) 1);
			} LA8: ;
		}
	}
	}BeforeRet_: ;
	return result;
}
static N_INLINE(NF32, abs__OOZfauZsrcZfauZfmath_71)(NF32 x) {
	NF32 result;
	result = (NF32)0;
	result = fabsf(x);
	return result;
}
static N_INLINE(NF32, fractional__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_177)(NF32 v) {
	NF32 result;
	NF32 T1_;
	result = abs__OOZfauZsrcZfauZfmath_71(v);
	T1_ = (NF32)0;
	T1_ = floorf(result);
	result = ((NF32)(result) - (NF32)(T1_));
	return result;
}
static N_INLINE(NIM_BOOL, inside__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_51)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask, NI x, NI y) {
	NIM_BOOL result;
	NIM_BOOL T1_;
	NIM_BOOL T2_;
	NIM_BOOL T3_;
	result = (NIM_BOOL)0;
	T1_ = (NIM_BOOL)0;
	T2_ = (NIM_BOOL)0;
	T3_ = (NIM_BOOL)0;
	T3_ = (((NI) 0) <= x);
	if (!(T3_)) goto LA4_;
	T3_ = (x < (*mask).width);
	LA4_: ;
	T2_ = T3_;
	if (!(T2_)) goto LA5_;
	T2_ = (((NI) 0) <= y);
	LA5_: ;
	T1_ = T2_;
	if (!(T1_)) goto LA6_;
	T1_ = (y < (*mask).height);
	LA6_: ;
	result = T1_;
	return result;
}
static N_INLINE(NU8, X5BX5D___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_72)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask, NI x, NI y) {
	NU8 result;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = (NU8)0;
	{
		NIM_BOOL T3_;
		tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T6_;
		tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ T7_;
		NI T8_;
		T3_ = (NIM_BOOL)0;
		T3_ = inside__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_51(mask, x, y);
		if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
		if (!T3_) goto LA4_;
		nimZeroMem((void*)(&T6_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
		nimZeroMem((void*)(&T6_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
		T6_.mask = mask;
		nimZeroMem((void*)(&T7_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
		nimZeroMem((void*)(&T7_), sizeof(tyObject_UnsafeMask__JgoC9aWXuxjiQT29aYsy7flQ));
		T7_.mask = mask;
		T8_ = (NI)0;
		T8_ = dataIndex__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_56(T7_.mask, x, y);
		if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
		result = (*T6_.mask).data.p->data[T8_];
		goto BeforeRet_;
	}
	LA4_: ;
	}BeforeRet_: ;
	return result;
}
static N_INLINE(NU8, mix__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZcommon_29)(NU8 a, NU8 b, NF32 t) {
	NU8 result;
	NU32 t_2;
	NF32 T1_;
	result = (NU8)0;
	T1_ = (NF32)0;
	T1_ = roundf(((NF32)(t) * (NF32)(255.0f)));
	t_2 = ((NU32) (T1_));
	result = ((NU8) ((NU32)((NU32)((NU32)((NU32)((NU32)((NU32)(((NU32) (a))) * (NU32)((NU32)((NU32)(((NU32) 255)) - (NU32)(t_2))))) + (NU32)((NU32)((NU32)(((NU32) (b))) * (NU32)(t_2))))) / (NU32)(((NU32) 255)))));
	return result;
}
N_LIB_PRIVATE N_NIMCALL(NU8, getValueSmooth__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_168)(tyObject_MaskcolonObjectType___9c471pIledZjhw4w4ER6K0Q* mask, NF32 x, NF32 y) {
	NU8 result;
	NU8 colontmpD_;
	NU8 colontmpD__2;
	NI x0;
	NI y0;
	NI x1;
	NI y1;
	NF32 xFractional;
	NF32 yFractional;
	NU8 x0y0;
	NU8 x1y0;
	NU8 x0y1;
	NU8 x1y1;
	NU8 topMix;
	NU8 bottomMix;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = (NU8)0;
	colontmpD_ = (NU8)0;
	colontmpD__2 = (NU8)0;
	x0 = ((NI) (x));
	y0 = ((NI) (y));
	x1 = (NI)(x0 + ((NI) 1));
	y1 = (NI)(y0 + ((NI) 1));
	xFractional = fractional__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_177(x);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	yFractional = fractional__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_177(y);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	x0y0 = X5BX5D___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_72(mask, x0, y0);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	x1y0 = X5BX5D___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_72(mask, x1, y0);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	x0y1 = X5BX5D___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_72(mask, x0, y1);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	x1y1 = X5BX5D___OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZmasks_72(mask, x1, y1);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	topMix = x0y0;
	{
		NIM_BOOL T3_;
		T3_ = (NIM_BOOL)0;
		T3_ = (0.0f < xFractional);
		if (!(T3_)) goto LA4_;
		T3_ = !((x0y0 == x1y0));
		LA4_: ;
		if (!T3_) goto LA5_;
		topMix = mix__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZcommon_29(x0y0, x1y0, xFractional);
		if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}
	LA5_: ;
	bottomMix = x0y1;
	{
		NIM_BOOL T9_;
		T9_ = (NIM_BOOL)0;
		T9_ = (0.0f < xFractional);
		if (!(T9_)) goto LA10_;
		T9_ = !((x0y1 == x1y1));
		LA10_: ;
		if (!T9_) goto LA11_;
		bottomMix = mix__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZcommon_29(x0y1, x1y1, xFractional);
		if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}
	LA11_: ;
	{
		NIM_BOOL T15_;
		T15_ = (NIM_BOOL)0;
		T15_ = !((yFractional == 0.0f));
		if (!(T15_)) goto LA16_;
		T15_ = !((topMix == bottomMix));
		LA16_: ;
		if (!T15_) goto LA17_;
		colontmpD_ = mix__OOZOOZOOZOnimbleZpkgsZpixie4552O48O49ZpixieZcommon_29(topMix, bottomMix, yFractional);
		if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
		result = colontmpD_;
	}
	goto LA13_;
	LA17_: ;
	{
		colontmpD__2 = topMix;
		result = colontmpD__2;
	}
	LA13_: ;
	}BeforeRet_: ;
	return result;
}
