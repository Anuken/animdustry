/* Generated by Nim Compiler v1.6.4 */
#define NIM_INTBITS 32
#define NIM_EmulateOverflowChecks

#include "nimbase.h"
#include <string.h>
#undef LANGUAGE_C
#undef MIPSEB
#undef MIPSEL
#undef PPC
#undef R3000
#undef R4000
#undef i386
#undef linux
#undef mips
#undef near
#undef far
#undef powerpc
#undef unix
#define nimfr_(x, y)
#define nimln_(x, y)
typedef struct tySequence__uFLLGQVsiasALrzzzvqnZw tySequence__uFLLGQVsiasALrzzzvqnZw;
typedef struct tySequence__uFLLGQVsiasALrzzzvqnZw_Content tySequence__uFLLGQVsiasALrzzzvqnZw_Content;
typedef struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ tySequence__6H5Oh5UUvVCLiakt9aTwtUQ;
typedef struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content;
typedef struct tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g;
typedef struct Exception Exception;
typedef struct RootObj RootObj;
typedef struct TNimTypeV2 TNimTypeV2;
typedef struct NimStrPayload NimStrPayload;
typedef struct NimStringV2 NimStringV2;
typedef struct tySequence__uB9b75OUPRENsBAu4AnoePA tySequence__uB9b75OUPRENsBAu4AnoePA;
typedef struct tySequence__uB9b75OUPRENsBAu4AnoePA_Content tySequence__uB9b75OUPRENsBAu4AnoePA_Content;
typedef struct tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A;
typedef struct tySequence__4Xyxy0Om14N6K1l5e9bUPSQ tySequence__4Xyxy0Om14N6K1l5e9bUPSQ;
typedef struct tySequence__4Xyxy0Om14N6K1l5e9bUPSQ_Content tySequence__4Xyxy0Om14N6K1l5e9bUPSQ_Content;
typedef struct tyObject_StackTraceEntry__oLyohQ7O2XOvGnflOss8EA tyObject_StackTraceEntry__oLyohQ7O2XOvGnflOss8EA;
struct tySequence__uFLLGQVsiasALrzzzvqnZw {
  NI len; tySequence__uFLLGQVsiasALrzzzvqnZw_Content* p;
};
struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ {
  NI len; tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content* p;
};
struct TNimTypeV2 {
void* destructor;
NI size;
NI align;
NCSTRING name;
void* traceImpl;
void* typeInfoV1;
NI flags;
};
struct RootObj {
TNimTypeV2* m_type;
};
struct NimStrPayload {
NI cap;
NIM_CHAR data[SEQ_DECL_SIZE];
};
struct NimStringV2 {
NI len;
NimStrPayload* p;
};
struct tySequence__uB9b75OUPRENsBAu4AnoePA {
  NI len; tySequence__uB9b75OUPRENsBAu4AnoePA_Content* p;
};
struct Exception {
  RootObj Sup;
Exception* parent;
NCSTRING name;
NimStringV2 message;
tySequence__uB9b75OUPRENsBAu4AnoePA trace;
Exception* up;
};
struct tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g {
  Exception Sup;
};
struct tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A {
NI rc;
};
struct tySequence__4Xyxy0Om14N6K1l5e9bUPSQ {
  NI len; tySequence__4Xyxy0Om14N6K1l5e9bUPSQ_Content* p;
};


#ifndef tySequence__uFLLGQVsiasALrzzzvqnZw_Content_PP
#define tySequence__uFLLGQVsiasALrzzzvqnZw_Content_PP
struct tySequence__uFLLGQVsiasALrzzzvqnZw_Content { NI cap; NU16 data[SEQ_DECL_SIZE];};
#endif

      

#ifndef tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content_PP
#define tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content_PP
struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content { NI cap; NU8 data[SEQ_DECL_SIZE];};
#endif

      struct tyObject_StackTraceEntry__oLyohQ7O2XOvGnflOss8EA {
NCSTRING procname;
NI line;
NCSTRING filename;
};


#ifndef tySequence__uB9b75OUPRENsBAu4AnoePA_Content_PP
#define tySequence__uB9b75OUPRENsBAu4AnoePA_Content_PP
struct tySequence__uB9b75OUPRENsBAu4AnoePA_Content { NI cap; tyObject_StackTraceEntry__oLyohQ7O2XOvGnflOss8EA data[SEQ_DECL_SIZE];};
#endif

      

#ifndef tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content_PP
#define tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content_PP
struct tySequence__6H5Oh5UUvVCLiakt9aTwtUQ_Content { NI cap; NU8 data[SEQ_DECL_SIZE];};
#endif

      

#ifndef tySequence__4Xyxy0Om14N6K1l5e9bUPSQ_Content_PP
#define tySequence__4Xyxy0Om14N6K1l5e9bUPSQ_Content_PP
struct tySequence__4Xyxy0Om14N6K1l5e9bUPSQ_Content { NI cap; NF32 data[SEQ_DECL_SIZE];};
#endif

      N_LIB_PRIVATE N_NIMCALL(void, alignedDealloc)(void* p, NI align);
N_LIB_PRIVATE N_NIMCALL(void, setLen__OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_185)(tySequence__uFLLGQVsiasALrzzzvqnZw* s, NI newlen);
N_CDECL(unsigned char*, stbi_load_from_memory)(unsigned char* buffer, int len, int* x, int* y, int* channels_in_file, int desired_channels);
N_LIB_PRIVATE N_NIMCALL(void*, nimNewObj)(NI size, NI alignment);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_62)(tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g* dest);
static N_INLINE(NIM_BOOL, nimDecRefIsLast)(void* p);
static N_INLINE(NI, minuspercent___system_716)(NI x, NI y);
N_LIB_PRIVATE N_NIMCALL(void, nimDestroyAndDispose)(void* p);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___system_2592)(NimStringV2* dest);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___system_2621)(tySequence__uB9b75OUPRENsBAu4AnoePA* dest);
N_LIB_PRIVATE N_NIMCALL(NimStringV2, failureReason__OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_7)(void);
N_CDECL(NCSTRING, stbi_failure_reason)(void);
N_LIB_PRIVATE N_NIMCALL(NimStringV2, cstrToNimstr)(NCSTRING str);
N_LIB_PRIVATE N_NIMCALL(void, raiseExceptionEx)(Exception* e, NCSTRING ename, NCSTRING procname, NCSTRING filename, NI line);
N_LIB_PRIVATE N_NIMCALL(void, newSeq__stdZsysrand_57)(tySequence__6H5Oh5UUvVCLiakt9aTwtUQ* s, NI len);
static N_INLINE(void, copyMem__system_1709)(void* dest, void* source, NI size);
static N_INLINE(void, nimCopyMem)(void* dest, void* source, NI size);
N_CDECL(void, stbi_image_free)(void* retval_from_stbi_load);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___pureZtimes_1997)(tySequence__6H5Oh5UUvVCLiakt9aTwtUQ* dest);
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_264)(tySequence__uFLLGQVsiasALrzzzvqnZw* dest);
N_LIB_PRIVATE N_NIMCALL(void, setLen__OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_384)(tySequence__4Xyxy0Om14N6K1l5e9bUPSQ* s, NI newlen);
N_LIB_PRIVATE TNimTypeV2 NTIv2__aAYcUpgFrulYo6HIdrPA3g_;
extern NIM_BOOL nimInErrorMode__system_3443;
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_264)(tySequence__uFLLGQVsiasALrzzzvqnZw* dest) {
	if ((*dest).p && !((*dest).p->cap & NIM_STRLIT_FLAG)) {
 alignedDealloc((*dest).p, NIM_ALIGNOF(NU16));
}
}
N_LIB_PRIVATE N_NIMCALL(void, eqcopy___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_267)(tySequence__uFLLGQVsiasALrzzzvqnZw* dest, tySequence__uFLLGQVsiasALrzzzvqnZw src) {
	NI T1_;
	NI colontmp_;
	T1_ = src.len;
	setLen__OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_185((&(*dest)), T1_);
	colontmp_ = ((NI) 0);
	{
		while (1) {
			NI T4_;
			T4_ = (*dest).len;
			if (!(colontmp_ < T4_)) goto LA3;
			(*dest).p->data[colontmp_] = src.p->data[colontmp_];
			colontmp_ += ((NI) 1);
		} LA3: ;
	}
}
static N_INLINE(NI, minuspercent___system_716)(NI x, NI y) {
	NI result;
	result = (NI)0;
	result = ((NI) ((NU)((NU32)(((NU) (x))) - (NU32)(((NU) (y))))));
	return result;
}
static N_INLINE(NIM_BOOL, nimDecRefIsLast)(void* p) {
	NIM_BOOL result;
	result = (NIM_BOOL)0;
	{
		tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A* cell;
		NI T5_;
		if (!!((p == NIM_NIL))) goto LA3_;
		T5_ = (NI)0;
		T5_ = minuspercent___system_716(((NI) (ptrdiff_t) (p)), ((NI) 4));
		cell = ((tyObject_RefHeader__Gi7WQzlT1ZRToh9a2ueYb4A*) (T5_));
		{
			if (!((NI)((*cell).rc & ((NI) -8)) == ((NI) 0))) goto LA8_;
			result = NIM_TRUE;
		}
		goto LA6_;
		LA8_: ;
		{
			(*cell).rc -= ((NI) 8);
		}
		LA6_: ;
	}
	LA3_: ;
	return result;
}
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_62)(tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g* dest) {
	{
		NIM_BOOL T3_;
		T3_ = (NIM_BOOL)0;
		T3_ = nimDecRefIsLast((*dest).Sup.parent);
		if (!T3_) goto LA4_;
		nimDestroyAndDispose((*dest).Sup.parent);
	}
	LA4_: ;
	eqdestroy___system_2592((&(*dest).Sup.message));
	eqdestroy___system_2621((&(*dest).Sup.trace));
	{
		NIM_BOOL T8_;
		T8_ = (NIM_BOOL)0;
		T8_ = nimDecRefIsLast((*dest).Sup.up);
		if (!T8_) goto LA9_;
		nimDestroyAndDispose((*dest).Sup.up);
	}
	LA9_: ;
}
N_LIB_PRIVATE N_NIMCALL(NimStringV2, failureReason__OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_7)(void) {
	NimStringV2 result;
	NCSTRING T1_;
{	result.len = 0; result.p = NIM_NIL;
	T1_ = (NCSTRING)0;
	T1_ = stbi_failure_reason();
	result = cstrToNimstr(T1_);
	goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}
static N_INLINE(void, nimCopyMem)(void* dest, void* source, NI size) {
	void* T1_;
	T1_ = (void*)0;
	T1_ = memcpy(dest, source, ((size_t) (size)));
}
static N_INLINE(void, copyMem__system_1709)(void* dest, void* source, NI size) {
	nimCopyMem(dest, source, size);
}
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void) {
	NIM_BOOL* result;
	result = (NIM_BOOL*)0;
	result = (&nimInErrorMode__system_3443);
	return result;
}
N_LIB_PRIVATE N_NIMCALL(tySequence__6H5Oh5UUvVCLiakt9aTwtUQ, loadFromMemory__OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_86)(tySequence__6H5Oh5UUvVCLiakt9aTwtUQ buffer, NI* x, NI* y, NI* channels_in_file, NI desired_channels) {
	tySequence__6H5Oh5UUvVCLiakt9aTwtUQ result;
	NI colontmpD_;
	NI colontmpD__2;
	tySequence__6H5Oh5UUvVCLiakt9aTwtUQ pixelData;
	unsigned char* castedBuffer;
	int width;
	int height;
	int components;
	unsigned char* data;
	NI T2_;
	NI actual_channels;
	NI T13_;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result.len = 0; result.p = NIM_NIL;
	colontmpD_ = (NI)0;
	colontmpD__2 = (NI)0;
	pixelData.len = 0; pixelData.p = NIM_NIL;
	castedBuffer = ((unsigned char*) ((&buffer.p->data[((NI) 0)])));
	width = (int)0;
	height = (int)0;
	components = (int)0;
	T2_ = buffer.len;
	data = stbi_load_from_memory(castedBuffer, ((int) (T2_)), (&width), (&height), (&components), ((int) (desired_channels)));
	{
		tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g* T7_;
		if (!(data == ((unsigned char*) NIM_NIL))) goto LA5_;
		T7_ = NIM_NIL;
		T7_ = (tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g*) nimNewObj(sizeof(tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g), NIM_ALIGNOF(tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g));
		(*T7_).Sup.Sup.m_type = (&NTIv2__aAYcUpgFrulYo6HIdrPA3g_);
		(*T7_).Sup.name = "STBIException";
		(*T7_).Sup.message = failureReason__OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_7();
		if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
		(*T7_).Sup.parent = ((Exception*) NIM_NIL);
		raiseExceptionEx((Exception*)T7_, "STBIException", "loadFromMemory", "read.nim", 138);
		goto LA1_;
	}
	LA5_: ;
	(*x) = ((NI) (width));
	(*y) = ((NI) (height));
	(*channels_in_file) = ((NI) (components));
	{
		if (!(((NI) 0) < desired_channels)) goto LA10_;
		colontmpD_ = desired_channels;
		actual_channels = colontmpD_;
	}
	goto LA8_;
	LA10_: ;
	{
		colontmpD__2 = ((NI) (components));
		actual_channels = colontmpD__2;
	}
	LA8_: ;
	newSeq__stdZsysrand_57((&pixelData), ((NI) ((NI)((NI)((*x) * (*y)) * actual_channels))));
	T13_ = pixelData.len;
	copyMem__system_1709(((void*) ((&pixelData.p->data[((NI) 0)]))), ((void*) (data)), ((NI) (T13_)));
	stbi_image_free(((void*) (data)));
	result = pixelData;
	pixelData.len = 0; pixelData.p = NIM_NIL;
	eqdestroy___pureZtimes_1997((&pixelData));
	goto BeforeRet_;
	{
		LA1_:;
	}
	{
		eqdestroy___pureZtimes_1997((&pixelData));
	}
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_463)(tySequence__4Xyxy0Om14N6K1l5e9bUPSQ* dest) {
	if ((*dest).p && !((*dest).p->cap & NIM_STRLIT_FLAG)) {
 alignedDealloc((*dest).p, NIM_ALIGNOF(NF32));
}
}
N_LIB_PRIVATE N_NIMCALL(void, eqsink___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_270)(tySequence__uFLLGQVsiasALrzzzvqnZw* dest, tySequence__uFLLGQVsiasALrzzzvqnZw src) {
	if ((*dest).p != src.p) {	eqdestroy___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_264(dest);
	}
(*dest).len = src.len; (*dest).p = src.p;
}
N_LIB_PRIVATE N_NIMCALL(void, eqcopy___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_466)(tySequence__4Xyxy0Om14N6K1l5e9bUPSQ* dest, tySequence__4Xyxy0Om14N6K1l5e9bUPSQ src) {
	NI T1_;
	NI colontmp_;
	T1_ = src.len;
	setLen__OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_384((&(*dest)), T1_);
	colontmp_ = ((NI) 0);
	{
		while (1) {
			NI T4_;
			T4_ = (*dest).len;
			if (!(colontmp_ < T4_)) goto LA3;
			(*dest).p->data[colontmp_] = src.p->data[colontmp_];
			colontmp_ += ((NI) 1);
		} LA3: ;
	}
}
N_LIB_PRIVATE N_NIMCALL(void, stb_image_readDatInit000)(void) {
NTIv2__aAYcUpgFrulYo6HIdrPA3g_.destructor = (void*)eqdestroy___OOZOOZOOZOnimbleZpkgsZstb95image4550O53Zstb95imageZread_62; NTIv2__aAYcUpgFrulYo6HIdrPA3g_.size = sizeof(tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g); NTIv2__aAYcUpgFrulYo6HIdrPA3g_.align = NIM_ALIGNOF(tyObject_STBIException__aAYcUpgFrulYo6HIdrPA3g); NTIv2__aAYcUpgFrulYo6HIdrPA3g_.name = "|stb_image.read.STBIException|Exception|RootObj|";
; NTIv2__aAYcUpgFrulYo6HIdrPA3g_.traceImpl = (void*)NIM_NIL; NTIv2__aAYcUpgFrulYo6HIdrPA3g_.flags = 0;}

